<legend>Basket Summary</legend>
<% if @basket.line_items.size < 1 %>
  <p>Your cart is empty at the moment. <%= link_to 'Continue shopping', products_path %>
<% else %>
  <%= form_tag new_purchase_path, method: 'get' do |form| %>
    <%= render partial: 'shared/error_notice' %>
    <table class="table basket-summary">
      <tbody>
        <% @basket.line_items.each do |line_item| %>
          <% product = line_item.product %>
          <%= render partial: 'shared/basket_row', locals: {product: product, line_item: line_item,on_purchase: false} %>
        <% end %>
        <tr>
          <td class='hidden-xs'></td>
          <td class='hidden-xs'></td>
          <td>Voucher Discount</td>
          <td class="js-voucher-discount"><%= number_to_currency @basket.voucher_discount_in_dollars %></td>
        </tr>
        <tr>
          <td class='hidden-xs'></td>
          <td class='hidden-xs'></td>
          <td>Delivery Price</td>
          <td>
            <div class="form-group <%= flash[:error] ? 'has-error' : ''%>">
              <%= select_tag 'country', delivery_options_for_select, class: 'js-delivery-select form-control' %>
            </div>

          </td>
        </tr>
        <tr>
          <td class='hidden-xs'></td>
          <td class='hidden-xs'></td>
          <td>Total Price</td>
          <td><strong class="js-total-price"><%= number_to_currency(@basket.total_in_dollars) %></strong></td>
        </tr>
      </tbody>
    </table>

    <legend>Voucher</legend>
    <%= text_field_tag :voucher_code, @basket.voucher_code, placeholder: 'Voucher Code', class: 'js-voucher-code' %>

    <div class="form-group">
      <button class='btn btn-primary submit-button' type='submit'>Checkout now</button>
      <input class='btn submit-button' type='image' alt='Pay with Paypal' src="https://www.paypal.com/en_US/i/btn/btn_xpressCheckout.gif" name='paypal_checkout'></button>
    </div>
  <% end %>
<% end %>

<%= javascript_tag do %>
  new Basket('<%= basket_value_path %>')
<% end %>
